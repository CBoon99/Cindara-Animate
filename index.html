<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Cindara Animate</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://unpkg.com/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        :root {
            --primary: #6B48FF;
            --secondary: #00DDEB;
            --bg-dark: #1E1E2F;
            --text-light: #E6E6FA;
            --text-dark: #D3D3F5;
            --accent: #FF6F61;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --glow: 0 0 8px rgba(107, 72, 255, 0.5);
            --gradient: linear-gradient(135deg, #5F3DC4, #00A3E0);
            --font: 'Inter', 'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font);
            background: var(--gradient);
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            touch-action: none;
            transition: background 0.3s, color 0.3s;
        }

        body.dark {
            background: var(--bg-dark);
        }

        #container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            flex-direction: column;
            flex: 1;
            padding: 20px;
        }

        #header {
            text-align: center;
            padding: 20px;
        }

        #canvasContainer {
            position: relative;
            background: #2A2A3A;
            border-radius: 12px;
            box-shadow: var(--shadow);
            height: 60vh;
            margin: 20px 0;
            overflow: hidden;
        }

        body.dark #canvasContainer {
            background: #1F1F2F;
        }

        #flowCanvas, #flowSvgContainer {
            width: 100%;
            height: 100%;
            display: none;
            position: absolute;
            top: 0;
            left: 0;
        }

        #flowSvgContainer {
            overflow: hidden;
        }

        #inspector {
            padding: 20px;
            background: #2A2A3A;
            border-radius: 12px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 20px;
        }

        body.dark #inspector {
            background: #1F1F2F;
        }

        h1, h2 {
            color: var(--accent);
            margin: 0 0 12px;
            font-weight: 600;
        }

        #modeToggle, #flameControls, #playbackControls, #sceneControls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .toggle-btn, .flame-btn, .action-btn, .export-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            background: var(--primary);
            color: #fff;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .toggle-btn:hover, .flame-btn:hover, .action-btn:hover, .export-btn:hover {
            background: var(--secondary);
            box-shadow: 0 0 12px rgba(107, 72, 255, 0.7);
            transform: scale(1.05);
        }

        .toggle-btn.active, .flame-btn.active, .action-btn.active {
            background: var(--accent);
            box-shadow: 0 0 12px rgba(255, 111, 97, 0.7);
        }

        .toggle-btn:disabled, .action-btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
            box-shadow: none;
        }

        #timeline {
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px;
            background: #333344;
            border-radius: 12px;
            overflow-y: auto;
            max-height: 300px;
        }

        body.dark #timeline {
            background: #2A2A3A;
        }

        #scrubBar {
            width: 100%;
            height: 24px;
            background: #444455;
            position: relative;
            cursor: pointer;
            border-radius: 12px;
        }

        body.dark #scrubBar {
            background: #333344;
        }

        #scrubHead {
            position: absolute;
            width: 6px;
            height: 100%;
            background: var(--accent);
            border-radius: 3px;
            top: 0;
            box-shadow: var(--glow);
        }

        .object-timeline {
            margin-top: 12px;
            padding: 8px;
            background: #2A2A3A;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        body.dark .object-timeline {
            background: #1F1F2F;
        }

        .keyframe {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--accent);
            border-radius: 50%;
            cursor: move;
            top: -5px;
            box-shadow: var(--glow);
        }

        #motionPanel, #objectList {
            max-height: 240px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px;
            background: #333344;
            border-radius: 12px;
        }

        body.dark #motionPanel, body.dark #objectList {
            background: #2A2A3A;
        }

        .object-item {
            padding: 8px;
            margin-bottom: 8px;
            background: #2A2A3A;
            border-radius: 12px;
            cursor: move;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        body.dark .object-item {
            background: #1F1F2F;
        }

        .object-item.selected {
            background: rgba(255, 111, 97, 0.2);
        }

        .object-item.dragging {
            opacity: 0.5;
        }

        .object-item input {
            width: 120px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 4px;
            font-family: var(--font);
            background: #444455;
            color: var(--text-light);
        }

        #motionPanel input, #motionPanel select {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 8px;
            font-family: var(--font);
            background: #444455;
            color: var(--text-light);
        }

        #dropZone {
            width: 100%;
            height: 120px;
            border: 2px dashed var(--accent);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 500;
        }

        #dropZone.dragover {
            background: rgba(255, 111, 97, 0.2);
        }

        #footer {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
            font-size: 0.9em;
        }

        body.dark #footer {
            color: var(--text-dark);
        }

        #footer a {
            color: var(--accent);
            text-decoration: none;
        }

        #footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            #canvasContainer {
                height: 50vh;
                margin: 10px 0;
            }

            #inspector {
                margin-bottom: 10px;
            }
        }

        @media (max-width: 480px) {
            h1, h2 {
                font-size: 1.4em;
            }

            .toggle-btn, .flame-btn, .action-btn {
                font-size: 0.8em;
                padding: 8px 16px;
            }
        }
    </style>
</head>
<body class="dark">
    <div id="container">
        <div id="canvasContainer">
            <canvas id="flowCanvas"></canvas>
            <div id="flowSvgContainer"></div>
            <div id="dropZone">Drag & Drop SVG, Image, or 3D Object</div>
        </div>
        <div id="inspector">
            <h1>Cindara Animate</h1>
            <div id="modeToggle">
                <button class="toggle-btn active" data-mode="2d">2D</button>
                <button class="toggle-btn" data-mode="3d">3D</button>
            </div>
            <div id="flameControls">
                <button class="flame-btn" onclick="Cindara.Flame.toggleSpeed()">Speed: Fast</button>
                <button class="flame-btn" onclick="Cindara.Flame.cycleTheme()">Theme: Primary</button>
                <button class="flame-btn" onclick="Cindara.Flame.toggleDarkMode()">Dark Mode: On</button>
            </div>
            <div id="sceneControls">
                <h2>Scene</h2>
                <button class="action-btn" onclick="Cindara.Scene.resetView()">Reset View</button>
                <button class="action-btn" onclick="Cindara.Scene.toggleGrid()">Toggle Grid</button>
                <label>Duration: <input type="number" id="sceneDuration" value="5" min="1" step="1" onchange="Cindara.Scene.setDuration(this.value)"></label>
                <label>Easing: <select id="globalEasing" onchange="Cindara.Scene.setEasing(this.value)">
                    <option value="linear">Linear</option>
                    <option value="easeInOut">Ease In/Out</option>
                    <option value="bounce">Bounce</option>
                </select></label>
                <label><input type="checkbox" id="snapToggle" onchange="Cindara.Scene.toggleSnap(this.checked)"> Snap to Grid</label>
            </div>
            <div id="playbackControls">
                <h2>Playback</h2>
                <button class="action-btn" id="playBtn" onclick="Cindara.Timeline.togglePlay()">Play</button>
                <button class="action-btn" id="stopBtn" onclick="Cindara.Timeline.stop()">Stop</button>
                <label>Loop: <input type="checkbox" id="loopToggle" onchange="Cindara.Timeline.setLoop(this.checked)"></label>
                <label>FPS: <select id="fpsToggle" onchange="Cindara.Timeline.setFPS(this.value)">
                    <option value="24">24</option>
                    <option value="30" selected>30</option>
                    <option value="60">60</option>
                </select></label>
            </div>
            <div id="timeline">
                <h2>Timeline

</h2>
                <div id="scrubBar"><div id="scrubHead"></div></div>
                <div id="objectTimelines"></div>
            </div>
            <div id="motionPanel">
                <h2>Motion</h2>
            </div>
            <div id="objectList">
                <h2>Objects</h2>
            </div>
            <div id="exportSection">
                <h2>Export</h2>
                <button class="export-btn" onclick="Cindara.Export.lottie()">Lottie</button>
                <button class="export-btn" onclick="Cindara.Export.lux()">Cindara JSON</button>
                <button class="export-btn" onclick="Cindara.Export.embed()">Embed</button>
            </div>
            <div id="stateControls">
                <h2>State</h2>
                <button class="action-btn" id="saveBtn" onclick="Cindara.State.save()">Save</button>
                <button class="action-btn" id="loadBtn" onclick="Cindara.State.load()">Load</button>
                <button class="action-btn" id="undoBtn" onclick="Cindara.State.undo()" disabled>Undo</button>
                <button class="action-btn" id="redoBtn" onclick="Cindara.State.redo()" disabled>Redo</button>
            </div>
        </div>
    </div>
    <div id="footer">
        Made by Cindara Team | <a href="https://cindara-animate.netlify.app">cindara-animate.netlify.app</a>
    </div>

    <script>
        const Cindara = {
            Core: {
                init: () => {
                    Cindara._state.mode = '2d';
                    Cindara._state.speed = 'fast';
                    Cindara._state.themeIndex = 0;
                    Cindara._state.snap = false;
                    Cindara._state.duration = 5;
                    Cindara._state.easing = 'easeInOut';
                    Cindara._state.fps = 30;
                    Cindara._state.isPlaying = false;
                    Cindara._state.loop = false;
                    Cindara._state.currentTime = 0;
                    Cindara._state.darkMode = true;
                    document.body.classList.add('dark');
                    Cindara.Scene.setup();
                    Cindara.UI.bind();
                    Cindara.Flame.apply();
                    Cindara.State.load();
                    Cindara.Core.animate();
                },
                animate: () => {
                    requestAnimationFrame(Cindara.Core.animate);
                    if (Cindara._state.mode === '3d' && Cindara._state.controls) {
                        Cindara._state.controls.update();
                        Cindara._state.renderer.render(Cindara._state.scene, Cindara._state.camera);
                    }
                    if (Cindara._state.isPlaying) {
                        Cindara._state.currentTime += 1 / Cindara._state.fps;
                        if (Cindara._state.currentTime > Cindara._state.duration) {
                            Cindara._state.currentTime = Cindara._state.loop ? 0 : Cindara._state.duration;
                            if (!Cindara._state.loop) {
                                Cindara.Timeline.togglePlay();
                            }
                        }
                        Cindara.Timeline.update();
                    }
                },
                switchMode: (mode) => {
                    if (['2d', '3d'].includes(mode) && mode !== Cindara._state.mode) {
                        Cindara._state.mode = mode;
                        const canvas = document.getElementById('flowCanvas');
                        const svgContainer = document.getElementById('flowSvgContainer');
                        if (mode === '3d') {
                            canvas.style.display = 'block';
                            svgContainer.style.display = 'none';
                            Cindara._state.scene = new THREE.Scene();
                            Cindara._state.camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
                            Cindara._state.camera.position.set(5, 5, 5);
                            Cindara._state.renderer = new THREE.WebGLRenderer({ canvas, antialias: Cindara._state.speed === 'final' });
                            Cindara._state.renderer.setSize(canvas.clientWidth, canvas.clientHeight);
                            Cindara._state.controls = new THREE.OrbitControls(Cindara._state.camera, canvas);
                            Cindara._state.controls.enableDamping = true;
                            Cindara._state.scene.add(new THREE.AmbientLight(0xffffff, 0.5));
                            const directional = new THREE.DirectionalLight(0xffffff, 0.5);
                            directional.position.set(5, 10, 5);
                            Cindara._state.scene.add(directional);
                            Cindara._state.grid = new THREE.GridHelper(10, 10, 0x888888, 0x888888);
                            Cindara._state.grid.visible = false;
                            Cindara._state.scene.add(Cindara._state.grid);
                            Cindara._state.objects.forEach(obj => {
                                if (obj.type === '3d') Cindara._state.scene.add(obj.mesh);
                            });
                        } else {
                            canvas.style.display = 'none';
                            svgContainer.style.display = 'block';
                            Cindara._state.renderer = null;
                            Cindara._state.controls = null;
                            Cindara._state.camera.position.set(0, 0, 1);
                            Cindara._state.scene = null;
                        }
                        Cindara.Flame.apply();
                        Cindara.UI.updateToggle();
                        Cindara.Timeline.update();
                    }
                }
            },

            Flame: {
                styles: {
                    colors: [
                        { primary: '#FF6F61', secondary: '#FF9F80', name: 'Primary', bg: '#2A2A3A' },
                        { primary: '#00DDEB', secondary: '#6B48FF', name: 'Cosmic', bg: '#1E1E2F' },
                        { primary: '#FF00CC', secondary: '#CC00FF', name: 'Neon', bg: '#2A1E3A' }
                    ],
                    gradients: [
                        'linear-gradient(135deg, #FF6F61, #FF9F80)',
                        'linear-gradient(135deg, #00DDEB, #6B48FF)',
                        'linear-gradient(135deg, #FF00CC, #CC00FF)'
                    ],
                    fonts: { primary: 'Inter, "SF Pro", sans-serif' }
                },
                apply: () => {
                    const { colors } = Cindara.Flame.styles;
                    const theme = colors[Cindara._state.themeIndex];
                    document.documentElement.style.setProperty('--primary', theme.primary);
                    document.documentElement.style.setProperty('--secondary', theme.secondary);
                    document.documentElement.style.setProperty('--gradient', Cindara.Flame.styles.gradients[Cindara._state.themeIndex]);
                    document.querySelectorAll('.toggle-btn, .action-btn, .export-btn, .flame-btn').forEach(el => {
                        el.style.fontFamily = Cindara.Flame.styles.fonts.primary;
                        if (el.classList.contains('toggle-btn') || el.classList.contains('flame-btn')) {
                            el.style.background = el.classList.contains('active') ? theme.primary : Cindara._state.darkMode ? '#444455' : '#ccc';
                        } else {
                            el.style.background = el.disabled ? '#ccc' : theme.primary;
                        }
                    });
                    document.querySelectorAll('h1, h2, #dropZone').forEach(el => {
                        el.style.color = theme.primary;
                    });
                    document.getElementById('dropZone').style.borderColor = theme.primary;
                    document.getElementById('canvasContainer').style.background = Cind